<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>积雪筱草的Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="搬砖人">
<meta property="og:type" content="website">
<meta property="og:title" content="积雪筱草的Blog">
<meta property="og:url" content="https://mohuani.github.io/page/2/index.html">
<meta property="og:site_name" content="积雪筱草的Blog">
<meta property="og:description" content="搬砖人">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="mohuani">
<meta property="article:tag" content="Bug工程师">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="积雪筱草的Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">积雪筱草的Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">流水账</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://mohuani.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Java/JsonWebToken" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/Java/JsonWebToken/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/Java/JsonWebToken/">JsonWebToken</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>参考阮一峰老师的博客：<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html</a></p>
<p>课程参考：<a target="_blank" rel="noopener" href="https://www.imooc.com/video/19018">https://www.imooc.com/video/19018</a></p>
<p>JWT官网：<a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a><br><img src="https://img-blog.csdnimg.cn/20190428161255871.png?x-oss-process=image/wat!%5B%E5%9C%A8%E8%BF%99%E9%87%8C%E6%8F%92%E5%85%A5%E5%9B%BE%E7%89%87%E6%8F%8F%E8%BF%B0%5D(https://img-blog.csdnimg.cn/2019042816125835.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dmazI5NzUwMTk2NzE=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20190428161617968.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dmazI5NzUwMTk2NzE=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/Java/JsonWebToken/" data-id="ckmujocly000a2vrs7ye24sx2" data-title="JsonWebToken" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Java/Maven基础入门" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/Java/Maven%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/Java/Maven%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/">Maven基础入门</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Maven-Learning-Notes"><a href="#Maven-Learning-Notes" class="headerlink" title="Maven Learning Notes"></a>Maven Learning Notes</h1><h1 id="Maven学习笔记"><a href="#Maven学习笔记" class="headerlink" title="Maven学习笔记"></a>Maven学习笔记</h1><hr>
<h2 id="一-介绍"><a href="#一-介绍" class="headerlink" title="一.介绍"></a>一.介绍</h2><p><strong>Maven</strong>是基于项目对象模型（POM），可以通过一小段描述信息来管理项目的构建、报告和文档的软件项目管理工具。</p>
<ol>
<li>bin目录是包含mvn的运行脚本</li>
<li>boot目录包含一个类加载器的框架，maven使用它加载自己的类库</li>
<li>conf配置文件</li>
<li>lib包含maven运行时的依赖类库</li>
</ol>
<h2 id="二-环境变量的配置"><a href="#二-环境变量的配置" class="headerlink" title="二.环境变量的配置"></a>二.环境变量的配置</h2><p><a target="_blank" rel="noopener" href="http://maven.apache.org/download.cgi" title="下载地址">点击下载</a><br><br><strong>maven</strong>环境配置，增加一个环境变量<strong>MAVEN_HOME</strong>,值是maven的安装路径（<code>C:\Program Files\apache-maven-3.5.0-bin\apache-maven-3.5.0</code>）<br>修改path则是在path最后面添加<code>;%MAVEN_HOME%\bin</code>。</p>
<h3 id="Maven的项目结构"><a href="#Maven的项目结构" class="headerlink" title="Maven的项目结构"></a>Maven的项目结构</h3><pre><code>项目名
    -src 
       -main
            -java
                 -package
       -test
            -java
                 -package
    -pom.xml
</code></pre>
<h2 id="三-常用命令"><a href="#三-常用命令" class="headerlink" title="三.常用命令"></a>三.常用命令</h2><pre><code>    mvn -v         查看maven版本
     compile    编译
     test        测试
     package    打包

     clean        删除target
     install    安装jar包到本地仓库
</code></pre>
<h3 id="maven快速创建项目骨架目录"><a href="#maven快速创建项目骨架目录" class="headerlink" title="maven快速创建项目骨架目录"></a>maven快速创建项目骨架目录</h3><h4 id="两种方式："><a href="#两种方式：" class="headerlink" title="两种方式："></a>两种方式：</h4><pre><code>1.  mvn archetype:generate 按照提示进行选择
2.  mvn archetype:generate  -DgroupId=com.imooc.maven   -DartifactId=
  maven-service   -Dversion=1.0.0SNAPSHOT   -Dpackage=com.imooc.maven.demo
    1. -DgroupId=组织名，公司网址反写+项目名
    2. -DartifactId=项目名+模块名
    3. -Dversion=版本号
    4. -Dpackage=代码所存在的包名
</code></pre>
<h2 id="四-Maven中的坐标和仓库"><a href="#四-Maven中的坐标和仓库" class="headerlink" title="四.Maven中的坐标和仓库"></a>四.Maven中的坐标和仓库</h2><p><strong>构件坐标:</strong></p>
<pre><code>        1. groupId:公司名字+项目名
        2. artifactId：项目名+模块名
        3. varsion:版本号
</code></pre>
<p><strong>仓库：</strong></p>
<pre><code>        1. 本地仓库
        2. 远程仓库
        3. 镜像仓库
</code></pre>
<h2 id="五-更改仓库默认路径"><a href="#五-更改仓库默认路径" class="headerlink" title="五.更改仓库默认路径"></a>五.更改仓库默认路径</h2><p>已安装到本地仓库中的jar包位置：</p>
<pre><code>C:\Users\用户\.m2\repository\com\tiakon\demo
</code></pre>
<p>安装路径conf文件夹下settings.xml文件<br>打开找到这段备注是的代码：</p>
<pre><code>      &lt;!-- localRepository
       | The path to the local repository maven will use to store artifacts.
       | Default: $&#123;user.home&#125;/.m2/repository
      &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;
      --&gt;
</code></pre>
<p>复制粘贴出来</p>
<pre><code>    &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;
</code></pre>
<p><strong>将localRepository便签内的值替换成新路径即可。</strong></p>
<h2 id="六-maven生命周期"><a href="#六-maven生命周期" class="headerlink" title="六.maven生命周期"></a>六.maven生命周期</h2><p>完整的项目构建过程包括：</p>
<p><strong>清理、编译、测试、打包、集成测试、验证、部署</strong></p>
<p><strong>maven三套独立的生命周期</strong></p>
<pre><code>    clean     清理项目
            1.pre-clean    执行清理前的工作
            2.clean        清理上一次构建生成的所有文件
            3.post-clean     执行清理后的文件

    default 构建项目（最核心）
            compile test package install

    site     生成项目站点
            1. pre-site     在生成项目站点前要完成的工作
            2. site     生成项目的站点文档
            3. post-site    在生成项目站点后要完成的工作
            4. site-deploy    发布生成的站点到服务器上
</code></pre>
<h2 id="七-maven中pom-xml常见元素介绍"><a href="#七-maven中pom-xml常见元素介绍" class="headerlink" title="七.maven中pom.xml常见元素介绍"></a>七.maven中pom.xml常见元素介绍</h2><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
             xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;!--指定了当前pom的版本--&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.tiakon.maven.demo&lt;/groupId&gt;
    &lt;artifactId&gt;HoictasStudio-MavenDemo01&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;!--
        第一个0表示大版本号
        第二个0表示分支版本号
        第三个0表示小版本号
        0.0.1
        snapshot    快照
        alpha       内部测试
        beta        公测
        Release     稳定
        GA          正式发布
    --&gt;
    &lt;!--
        打包方式:默认是jar,可选war、zip、pom
        &lt;packaging&gt;&lt;/packaging&gt;
    --&gt;
    &lt;!--
        项目名
        &lt;name&gt;&lt;/name&gt;
        项目地址
        &lt;url&gt;&lt;/url&gt;
        项目描述
        &lt;description&gt;&lt;/description&gt;
        开发人员列表
        &lt;developers&gt;&lt;/developers&gt;
        许可证信息
        &lt;licenses&gt;&lt;/licenses&gt;
        组织信息
        &lt;organization&gt;&lt;/organization&gt;
    --&gt;
</code></pre>
<p>​<br>        <!--依赖列表--><br>        <dependencies><br>            <!--依赖项--><br>            <dependency><br>                <groupId>junit</groupId><br>                <artifactId>junit</artifactId><br>                <version>RELEASE</version><br>                <!--<type></type>--><br>                <!--依赖范围--><br>                <!--<scope></scope>--><br>                <!--设置依赖是否可选（默认）false--><br>                <!--<optional></optional>--><br>                <!--排斥依赖传递列表--><br>                <!--
                    <exclusions>
                        <exclusion>
                        </exclusion>
                    </exclusions>
                --><br>            </dependency><br>        </dependencies><br>        <!--依赖的管理，作用主要定义在父模块中，对子模块进行管理--><br>        &lt;!–<br>            <dependencyManagement><br>                <dependencies></p>
<pre><code>            &lt;/dependencies&gt;
        &lt;/dependencyManagement&gt;
    --&gt;
    &lt;!--对构件的行为提供相应的支持--&gt;
    &lt;build&gt;
        &lt;!--插件列表--&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-source-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.0.1&lt;/version&gt;

                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;
                                jar-no-fork
                            &lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
    &lt;!--通常用于子模块对父模块pom的继承--&gt;
    &lt;!--&lt;parent&gt;&lt;/parent&gt;--&gt;
    &lt;!--用来聚合运行Maven项目，指定多个模块一起编译--&gt;
    &lt;!--
        &lt;modules&gt;
            &lt;module&gt;&lt;/module&gt;
        &lt;/modules&gt;
    --&gt;

&lt;/project&gt;
</code></pre>
<h2 id="八-Maven的依赖范围"><a href="#八-Maven的依赖范围" class="headerlink" title="八.Maven的依赖范围"></a>八.Maven的依赖范围</h2><pre><code>三种classpath
    1. 编译
    2. 测试
    3. 运行
</code></pre>
<p><strong>maven提供了6种可选依赖范围:</strong></p>
<pre><code>1. compile:    默认范围，编译测试运行都有效。

2. provided:    在编译和测试时有效。（比如说在开发JavaEE时，你在本地运行的servlet，
是需要调用已添加到项目中的servlet-api.jar这个jar包的。这个过程就包含了编译【就是
把Java文件编译成class文件的过程中也要调用】和测试【测试就是在本地运行】，那么他说
的运行是指，整个项目已开发完成，编译、测试通过后，将class文件或包含有class文件的war包
发布到服务器上的Tomcat中运行，这时启动项目，就可以直接调Tomcat中的servlet-api.jar，
不必再将自己的jar包添加到项目中去。也就是说当你选择provided时，项目发布时Maven不会将
你添加的jar包，加入到项目中。）

3. runtime:    在测试和运行时有效。(典型例子：JDBC驱动的实现。)
4. test:    只在测试是有效。
5. system:    类似provided，与本机系统相关联，可移植性差。

6. import:    导入范围，他只是用在dependencyManagement中，表示从其他的pom中导
入dependecy的配置。（以下引用官网案例并不难理解。）

Importing Dependencies

&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;maven&lt;/groupId&gt;
  &lt;artifactId&gt;B&lt;/artifactId&gt;
  &lt;packaging&gt;pom&lt;/packaging&gt;
  &lt;name&gt;B&lt;/name&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
                  &lt;dependency&gt;
                    &lt;groupId&gt;maven&lt;/groupId&gt;
                    &lt;artifactId&gt;A&lt;/artifactId&gt;
                    &lt;version&gt;1.0&lt;/version&gt;
                    &lt;type&gt;pom&lt;/type&gt;
                    &lt;scope&gt;import&lt;/scope&gt;
                  &lt;/dependency&gt;
                          &lt;dependency&gt;
                            &lt;groupId&gt;test&lt;/groupId&gt;
                            &lt;artifactId&gt;d&lt;/artifactId&gt;
                            &lt;version&gt;1.0&lt;/version&gt;
                          &lt;/dependency&gt;
        &lt;/dependencies&gt;
  &lt;/dependencyManagement&gt;
  &lt;dependencies&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;test&lt;/groupId&gt;
              &lt;artifactId&gt;a&lt;/artifactId&gt;
              &lt;version&gt;1.0&lt;/version&gt;
              &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;/dependency&gt;
                    &lt;dependency&gt;
                      &lt;groupId&gt;test&lt;/groupId&gt;
                      &lt;artifactId&gt;c&lt;/artifactId&gt;
                      &lt;scope&gt;runtime&lt;/scope&gt;
                    &lt;/dependency&gt;
  &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
<p>Assuming A is the pom defined in the preceding example, the end result would be the same. <strong>All of A’s managed dependencies would be incorporated into B except for d since it is defined in this pom.</strong></p>
<p>假设A是前面示例中定义的pom，那么最终结果将是相同的。<strong>所有管理的依赖项都将被合并到B中，除了在这个pom中定义的d之外。</strong></p>
<h2 id="九-依赖冲突"><a href="#九-依赖冲突" class="headerlink" title="九.依赖冲突"></a>九.依赖冲突</h2><pre><code>1.短路优先:

    C-&gt;B-&gt;A-&gt;X1(jar)
    C-&gt;B-&gt;X2(jar)

【C依赖B,B依赖A,A和B都包含同一个不同版本的Jar,则取B的依赖版本。（c的pom.xml中不必注明jar坐标）】

2.先声明先优先

    如果路径相同长度相同，则谁先声明，先解析谁。

【C依赖A和B,A和B都包含同一个不同版本的Jar,谁依赖在前取谁的依赖版本。】
</code></pre>
<h2 id="十-聚合与继承"><a href="#十-聚合与继承" class="headerlink" title="十.聚合与继承"></a>十.聚合与继承</h2><h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><pre><code>&lt;packaging&gt;pom&lt;/packaging&gt;
&lt;modules&gt;
    &lt;module&gt;../HoictasStudio-MavenDemo01&lt;/module&gt;
    &lt;module&gt;../HoictasStudio-MavenDemo02&lt;/module&gt;
    &lt;module&gt;../HoictasStudio-MavenDemo03&lt;/module&gt;
&lt;/modules&gt;
</code></pre>
<p>假设在<strong>HoictasStudio-MavenParent</strong>模块中添如以上代码，输入<code>clean install</code>命令后，即可同时安装多个jar到本地仓库中</p>
<pre><code>    [INFO] HoictasStudio-MavenDemo01 .......................... SUCCESS [  4.618 s]
    [INFO] HoictasStudio-MavenDemo02 .......................... SUCCESS [  0.828 s]
    [INFO] HoictasStudio-MavenDemo03 .......................... SUCCESS [  0.923 s]
    [INFO] HoictasStudio-MavenParent .......................... SUCCESS [  0.021 s]
</code></pre>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p><strong>根据官方文档说明继承会根据父模块与子模块的包含与否，对pom.xml的写法则有两种。</strong></p>
<h4 id="第一种写法"><a href="#第一种写法" class="headerlink" title="第一种写法"></a>第一种写法</h4><p>假设我们有两个模块，前一个叫 <code>com.mycompany.app:my-app:1</code>，后一个叫<code>com.mycompany.app:my-module:1</code>。</p>
<p>my-app的pom文件为：</p>
<pre><code>&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
  &lt;artifactId&gt;my-app&lt;/artifactId&gt;
  &lt;version&gt;1&lt;/version&gt;
&lt;/project&gt;
</code></pre>
<p>my-module的pom文件为：</p>
<pre><code>&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
  &lt;artifactId&gt;my-module&lt;/artifactId&gt;
  &lt;version&gt;1&lt;/version&gt;
&lt;/project&gt;
</code></pre>
<p>我们指定如下项目结构：</p>
<pre><code>    .
     |-- my-module
     |   `-- pom.xml
     `-- pom.xml
</code></pre>
<p>那么，我们需要<code>my-module</code>去继承<code>my-app</code>，则需要在<code>my-module</code>的pom文件中添加以下代码：</p>
<pre><code>    &lt;project&gt;
      &lt;parent&gt;
        &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
        &lt;artifactId&gt;my-app&lt;/artifactId&gt;
        &lt;version&gt;1&lt;/version&gt;
      &lt;/parent&gt;
      &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
      &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
      &lt;artifactId&gt;my-module&lt;/artifactId&gt;
      &lt;version&gt;1&lt;/version&gt;
    &lt;/project&gt;
</code></pre>
<h4 id="第二种写法"><a href="#第二种写法" class="headerlink" title="第二种写法"></a>第二种写法</h4><pre><code>However, that would work if the parent project was already installed inour local repository or was in that specific 
directory structure (parent pom.xml is one directory higher than that of the module&#39;s pom.xml). But what if the parent 
is not yet installed and if the directory structure is
.
 |-- my-module
 |   `-- pom.xml
 `-- parent
     `-- pom.xml    
</code></pre>
<p>上一段话摘自官网对继承的介绍，就是说如果你的父模块已在本地安装或者父模块不包含子模块，目录级别甚至是<br>比子模块的还要高，就在第一种写法上添加<code>&lt;relativePath&gt;</code>标签。</p>
<pre><code>&lt;project&gt;
      &lt;parent&gt;
        &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
        &lt;artifactId&gt;my-app&lt;/artifactId&gt;
        &lt;version&gt;1&lt;/version&gt;
        &lt;relativePath&gt;../parent/pom.xml&lt;/relativePath&gt;
      &lt;/parent&gt;
      &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
      &lt;artifactId&gt;my-module&lt;/artifactId&gt;
&lt;/project&gt;
</code></pre>
<p>笔者在看视频时就发现，当父模块与子模块处于同一级别时，在按照视频中的写法（第一种写法）test时就会报错，<br>而此时的情况是不包含子模块，所以应该在<code>&lt;parent&gt;</code>标签中添加<code>&lt;relativePath&gt;</code>标签即可测试通过。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/Java/Maven%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/" data-id="ckmujoclz000b2vrscdfldn8z" data-title="Maven基础入门" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Java/Netty入门之WebSocket-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/Java/Netty%E5%85%A5%E9%97%A8%E4%B9%8BWebSocket-1/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/Java/Netty%E5%85%A5%E9%97%A8%E4%B9%8BWebSocket-1/">Netty入门之WebSocket-1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>课程地址：<a target="_blank" rel="noopener" href="https://www.imooc.com/learn/1118">https://www.imooc.com/learn/1118</a></p>
<p><img src="../images/2019122712345645.png"></p>
<p><img src="../images/2020022021533739.png" alt="2020022021533739"></p>
<p><img src="../images/20191227123315503.png" alt="20191227123315503"></p>
<p><img src="../images/20191227123818509-1.png" alt="20191227123818509-1"></p>
<p><img src="../images/20191227123818509.png" alt="20191227123818509"></p>
<p><img src="../images/20191227123840309.png" alt="20191227123840309"></p>
<p><img src="../images/20191227124110634.png" alt="20191227124110634"></p>
<p><img src="../images/20191227124127188.png" alt="20191227124127188"></p>
<p><img src="../images/20191227124522259.png" alt="20191227124522259"></p>
<p><img src="../images/20191227124546309.png" alt="20191227124546309"></p>
<p><img src="../images/20191227125344840.png" alt="20191227125344840"></p>
<p><img src="../images/20191227125409161.png" alt="20191227125409161"></p>
<p><img src="../images/20191227125647446.png" alt="20191227125647446"></p>
<p><img src="../images/20191227125731360.png" alt="20191227125731360"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/Java/Netty%E5%85%A5%E9%97%A8%E4%B9%8BWebSocket-1/" data-id="ckmujocm0000c2vrsbeopem3g" data-title="Netty入门之WebSocket-1" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Java/Netty入门之WebSocket-2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/Java/Netty%E5%85%A5%E9%97%A8%E4%B9%8BWebSocket-2/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/Java/Netty%E5%85%A5%E9%97%A8%E4%B9%8BWebSocket-2/">Netty入门之WebSocket-2</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>课程代码<br><strong>websocket.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset = utf-8&quot;</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>WebSocket客户端<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> socket;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">if</span>(!<span class="built_in">window</span>.WebSocket)&#123;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">window</span>.WebSocket = <span class="built_in">window</span>.MozWebSocket;</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">		<span class="keyword">if</span>(<span class="built_in">window</span>.WebSocket)&#123;</span></span><br><span class="line"><span class="javascript">			socket = <span class="keyword">new</span> WebSocket(<span class="string">&quot;ws://localhost:8888/websocket&quot;</span>);</span></span><br><span class="line"><span class="javascript">			socket.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> ta = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;responseContent&#x27;</span>);</span></span><br><span class="line"><span class="javascript">				ta.value += event.data + <span class="string">&quot;\r\n&quot;</span>;</span></span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">			socket.onopen = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> ta = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;responseContent&#x27;</span>);</span></span><br><span class="line"><span class="javascript">				ta.value = <span class="string">&quot;你当前的浏览器支持WebSocket,请进行后续操作\r\n&quot;</span>;</span></span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">			socket.onclose = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> ta = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;responseContent&#x27;</span>);</span></span><br><span class="line"><span class="javascript">				ta.value = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="javascript">				ta.value = <span class="string">&quot;WebSocket连接已经关闭\r\n&quot;</span>;</span></span><br><span class="line">			&#125;;</span><br><span class="line"><span class="javascript">		&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">			alert(<span class="string">&quot;您的浏览器不支持WebSocket&quot;</span>);</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="javascript">		<span class="function"><span class="keyword">function</span> <span class="title">send</span>(<span class="params">message</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span>(!<span class="built_in">window</span>.WebSocket)&#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">return</span>;</span></span><br><span class="line">			&#125;</span><br><span class="line">			if(socket.readyState == WebSocket.OPEN)&#123;</span><br><span class="line">				socket.send(message);</span><br><span class="line"><span class="javascript">			&#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">				alert(<span class="string">&quot;WebSocket连接没有建立成功！！&quot;</span>);</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&quot;return false;&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">&quot;text&quot;</span> <span class="attr">name</span> = <span class="string">&quot;message&quot;</span> <span class="attr">value</span> = <span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">br</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">&quot;button&quot;</span> <span class="attr">value</span> = <span class="string">&quot;发送WebSocket请求消息&quot;</span> <span class="attr">onClick</span> = <span class="string">&quot;send(this.form.message.value)&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">hr</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">h2</span>&gt;</span>客户端接收到服务端返回的应答消息<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span> = <span class="string">&quot;responseContent&quot;</span> <span class="attr">style</span> = <span class="string">&quot;width:1024px; height:300px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>NettyConfig.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc.netty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.group.ChannelGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.group.DefaultChannelGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.concurrent.GlobalEventExecutor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 存储整个工程的全局配置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuyazhuang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettyConfig</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 存储每一个客户端接入进来时的channel对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> ChannelGroup group = <span class="keyword">new</span> DefaultChannelGroup(GlobalEventExecutor.INSTANCE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>MyWebSocketHandler.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc.netty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.ByteBuf;</span><br><span class="line"><span class="keyword">import</span> io.netty.buffer.Unpooled;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFuture;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelFutureListener;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.DefaultFullHttpResponse;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.FullHttpRequest;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpResponseStatus;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpVersion;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.CloseWebSocketFrame;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.PingWebSocketFrame;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.PongWebSocketFrame;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.TextWebSocketFrame;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.WebSocketFrame;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.WebSocketServerHandshaker;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.websocketx.WebSocketServerHandshakerFactory;</span><br><span class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接收/处理/响应客户端websocket请求的核心业务处理类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuyazhuang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebSocketHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> WebSocketServerHandshaker handshaker;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String WEB_SOCKET_URL = <span class="string">&quot;ws://localhost:8888/websocket&quot;</span>;</span><br><span class="line">	<span class="comment">//客户端与服务端创建连接的时候调用</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelActive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		NettyConfig.group.add(ctx.channel());</span><br><span class="line">		System.out.println(<span class="string">&quot;客户端与服务端连接开启...&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//客户端与服务端断开连接的时候调用</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelInactive</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		NettyConfig.group.remove(ctx.channel());</span><br><span class="line">		System.out.println(<span class="string">&quot;客户端与服务端连接关闭...&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//服务端接收客户端发送过来的数据结束之后调用</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelReadComplete</span><span class="params">(ChannelHandlerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">			ctx.flush();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//工程出现异常的时候调用</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		cause.printStackTrace();</span><br><span class="line">		ctx.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//服务端处理客户端websocket请求的核心方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">messageReceived</span><span class="params">(ChannelHandlerContext context, Object msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//处理客户端向服务端发起http握手请求的业务</span></span><br><span class="line">		<span class="keyword">if</span> (msg <span class="keyword">instanceof</span> FullHttpRequest) &#123;</span><br><span class="line">			handHttpRequest(context,  (FullHttpRequest)msg);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> WebSocketFrame) &#123; <span class="comment">//处理websocket连接业务</span></span><br><span class="line">			handWebsocketFrame(context, (WebSocketFrame)msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理客户端与服务端之前的websocket业务</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> frame</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handWebsocketFrame</span><span class="params">(ChannelHandlerContext ctx, WebSocketFrame frame)</span></span>&#123;</span><br><span class="line">		<span class="comment">//判断是否是关闭websocket的指令</span></span><br><span class="line">		<span class="keyword">if</span> (frame <span class="keyword">instanceof</span> CloseWebSocketFrame) &#123;</span><br><span class="line">			handshaker.close(ctx.channel(), (CloseWebSocketFrame)frame.retain());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//判断是否是ping消息</span></span><br><span class="line">		<span class="keyword">if</span> (frame <span class="keyword">instanceof</span> PingWebSocketFrame) &#123;</span><br><span class="line">			ctx.channel().write(<span class="keyword">new</span> PongWebSocketFrame(frame.content().retain()));</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//判断是否是二进制消息，如果是二进制消息，抛出异常</span></span><br><span class="line">		<span class="keyword">if</span>( ! (frame <span class="keyword">instanceof</span> TextWebSocketFrame) )&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;目前我们不支持二进制消息&quot;</span>);</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;【&quot;</span>+<span class="keyword">this</span>.getClass().getName()+<span class="string">&quot;】不支持消息&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//返回应答消息</span></span><br><span class="line">		<span class="comment">//获取客户端向服务端发送的消息</span></span><br><span class="line">		String request = ((TextWebSocketFrame) frame).text();</span><br><span class="line">		System.out.println(<span class="string">&quot;服务端收到客户端的消息====&gt;&gt;&gt;&quot;</span> + request);</span><br><span class="line">		TextWebSocketFrame tws = <span class="keyword">new</span> TextWebSocketFrame(<span class="keyword">new</span> Date().toString() </span><br><span class="line">																								+ ctx.channel().id() </span><br><span class="line">																								+ <span class="string">&quot; ===&gt;&gt;&gt; &quot;</span> </span><br><span class="line">																								+ request);</span><br><span class="line">		<span class="comment">//群发，服务端向每个连接上来的客户端群发消息</span></span><br><span class="line">		NettyConfig.group.writeAndFlush(tws);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理客户端向服务端发起http握手请求的业务</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handHttpRequest</span><span class="params">(ChannelHandlerContext ctx, FullHttpRequest req)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!req.getDecoderResult().isSuccess() </span><br><span class="line">				|| ! (<span class="string">&quot;websocket&quot;</span>.equals(req.headers().get(<span class="string">&quot;Upgrade&quot;</span>)))) &#123;</span><br><span class="line">			sendHttpResponse(ctx, req, </span><br><span class="line">					<span class="keyword">new</span> DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.BAD_REQUEST));</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		WebSocketServerHandshakerFactory wsFactory = <span class="keyword">new</span> WebSocketServerHandshakerFactory(</span><br><span class="line">				WEB_SOCKET_URL, <span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">		handshaker = wsFactory.newHandshaker(req);</span><br><span class="line">		<span class="keyword">if</span> (handshaker == <span class="keyword">null</span>) &#123;</span><br><span class="line">			WebSocketServerHandshakerFactory.sendUnsupportedWebSocketVersionResponse(ctx.channel());</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			handshaker.handshake(ctx.channel(), req);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 服务端向客户端响应消息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ctx</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> res</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendHttpResponse</span><span class="params">(ChannelHandlerContext ctx, FullHttpRequest req,</span></span></span><br><span class="line"><span class="function"><span class="params">			DefaultFullHttpResponse res)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (res.getStatus().code() != <span class="number">200</span>) &#123;</span><br><span class="line">			ByteBuf buf = Unpooled.copiedBuffer(res.getStatus().toString(), CharsetUtil.UTF_8);</span><br><span class="line">			res.content().writeBytes(buf);</span><br><span class="line">			buf.release();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//服务端向客户端发送数据</span></span><br><span class="line">		ChannelFuture f = ctx.channel().writeAndFlush(res);</span><br><span class="line">		<span class="keyword">if</span> (res.getStatus().code() != <span class="number">200</span>) &#123;</span><br><span class="line">			f.addListener(ChannelFutureListener.CLOSE);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>MyWebSocketChannelHandler.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc.netty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.channel.ChannelInitializer;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpObjectAggregator;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.codec.http.HttpServerCodec;</span><br><span class="line"><span class="keyword">import</span> io.netty.handler.stream.ChunkedWriteHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 初始化连接时候的各个组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuyazhuang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyWebSocketChannelHandler</span> <span class="keyword">extends</span> <span class="title">ChannelInitializer</span>&lt;<span class="title">SocketChannel</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		e.pipeline().addLast(<span class="string">&quot;http-codec&quot;</span>, <span class="keyword">new</span> HttpServerCodec());</span><br><span class="line">		e.pipeline().addLast(<span class="string">&quot;aggregator&quot;</span>, <span class="keyword">new</span> HttpObjectAggregator(<span class="number">65536</span>));</span><br><span class="line">		e.pipeline().addLast(<span class="string">&quot;http-chunked&quot;</span>, <span class="keyword">new</span> ChunkedWriteHandler());</span><br><span class="line">		e.pipeline().addLast(<span class="string">&quot;handler&quot;</span>, <span class="keyword">new</span> MyWebSocketHandler());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>Main.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.imooc.netty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.netty.bootstrap.ServerBootstrap;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.Channel;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.EventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</span><br><span class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioServerSocketChannel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 程序的入口，负责启动应用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liuyazhuang</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">		EventLoopGroup workGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			ServerBootstrap b = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line">			b.group(bossGroup, workGroup);</span><br><span class="line">			b.channel(NioServerSocketChannel.class);</span><br><span class="line">			b.childHandler(<span class="keyword">new</span> MyWebSocketChannelHandler());</span><br><span class="line">			System.out.println(<span class="string">&quot;服务端开启等待客户端连接....&quot;</span>);</span><br><span class="line">			Channel ch = b.bind(<span class="number">8888</span>).sync().channel();</span><br><span class="line">			ch.closeFuture().sync();</span><br><span class="line">			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="comment">//优雅的退出程序</span></span><br><span class="line">			bossGroup.shutdownGracefully();</span><br><span class="line">			workGroup.shutdownGracefully();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/Java/Netty%E5%85%A5%E9%97%A8%E4%B9%8BWebSocket-2/" data-id="ckmujocm1000d2vrsg94b6hnj" data-title="Netty入门之WebSocket-2" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Java/springboot启动失败常见问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/Java/springboot%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/Java/springboot%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/">springboot启动失败常见问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <!-- - 刚开始使用springboot连接mysql数据库，项目启动的时候报了一个错误 -->

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Loading class `com.mysql.jdbc.Driver<span class="string">&#x27;. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver&#x27;</span>. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.</span><br></pre></td></tr></table></figure>
<p>原因：现在很多定的教学视频都比较老，教学使用的mysql版本和你自己本地使用的版本不一致，新版本的mysql需要设置成  “com.mysql.cj.jdbc.Driver”，另外还需要增加一个参数 serverTimezone=UTC<br>参考文档：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43770545/article/details/90486809">https://blog.csdn.net/weixin_43770545/article/details/90486809</a></p>
<ul>
<li>项目启动的时候报错，很显然数据库没有正常连接<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.sql.SQLException: Access denied <span class="keyword">for</span> user <span class="string">&#x27;&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> (using password: NO)</span><br></pre></td></tr></table></figure>
我当时写的配置是，写的时候IDEA直接提示选了一个，单词没选对data-username 和 data-password，实际应该使用 username 和 password，主要还是没有记清楚配置。当作是一个教训吧。<br>错误的配置：<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/blog?useUnicode=true&amp;charseterEncoding=utf-8&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">data-username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">data-password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure>
正确的配置<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/blog?useUnicode=true&amp;charseterEncoding=utf-8&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/Java/springboot%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" data-id="ckmujocm2000e2vrs1wcyba13" data-title="springboot启动失败常见问题" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NGINX/Nginx unit" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/NGINX/Nginx%20unit/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/NGINX/Nginx%20unit/">Nginx unit</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>1、nginx  unit 的配置时直接在内存中更新的，如何做到语法错误检测<br>2、怎么配置不同语言的App应用<br>3、配置语法是怎样的，和nginx的区别大吗<br>4、不同语言的App在使用unit作为web容器的时候，都需要做出什么样的改动，例如：golang使用unit的时候需要将http.handler替换陈unit.handler</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/NGINX/Nginx%20unit/" data-id="ckmujocm3000f2vrs1gc8e6bv" data-title="Nginx unit" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NGINX/Nginx架构及核心流程及模块介绍" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/NGINX/Nginx%E6%9E%B6%E6%9E%84%E5%8F%8A%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B%E5%8F%8A%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/NGINX/Nginx%E6%9E%B6%E6%9E%84%E5%8F%8A%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B%E5%8F%8A%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D/">Nginx架构及核心流程及模块介绍</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Nginx架构及核心流程及模块介绍：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg2MjEyMDI5NA==&amp;mid=2247483697&amp;idx=1&amp;sn=a1e79703c39b00224ba613ba6c01a98e&amp;chksm=ce0df138f97a782e0f97a2748dd8c4d1b48941d6229f4b6d5e22b60a9edf2e46041be062eefc&amp;mpshare=1&amp;scene=24&amp;srcid=0314M9iypvJXOF6eYPXj9mx4&amp;key=bf4cf7f356eb27520c9277b9384b285123f7e2159c8b4f2dfc4e404b8d08db6c2dc3c3639b3ffc54cd4213fb1eb08860918edddf3081951de0b3fc834cf98bd32b84fb59b7604e54f11484b60f6a931f&amp;ascene=14&amp;uin=MTkwNjk4NjAxMA==&amp;devicetype=Windows+10&amp;version=62060833&amp;lang=zh_CN&amp;pass_ticket=JogDaVDjKXx9W3zQZ2sl6TAUdMDS7rKA0Zb9hMwwVMC4ALxeAySdvq8JADMCeINW">https://mp.weixin.qq.com/s?__biz=Mzg2MjEyMDI5NA==&amp;mid=2247483697&amp;idx=1&amp;sn=a1e79703c39b00224ba613ba6c01a98e&amp;chksm=ce0df138f97a782e0f97a2748dd8c4d1b48941d6229f4b6d5e22b60a9edf2e46041be062eefc&amp;mpshare=1&amp;scene=24&amp;srcid=0314M9iypvJXOF6eYPXj9mx4&amp;key=bf4cf7f356eb27520c9277b9384b285123f7e2159c8b4f2dfc4e404b8d08db6c2dc3c3639b3ffc54cd4213fb1eb08860918edddf3081951de0b3fc834cf98bd32b84fb59b7604e54f11484b60f6a931f&amp;ascene=14&amp;uin=MTkwNjk4NjAxMA%3D%3D&amp;devicetype=Windows+10&amp;version=62060833&amp;lang=zh_CN&amp;pass_ticket=JogDaVDjKXx9W3zQZ2sl6TAUdMDS7rKA0Zb9hMwwVMC4ALxeAySdvq8JADMCeINW</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/NGINX/Nginx%E6%9E%B6%E6%9E%84%E5%8F%8A%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B%E5%8F%8A%E6%A8%A1%E5%9D%97%E4%BB%8B%E7%BB%8D/" data-id="ckmujocm3000g2vrsha3y9y72" data-title="Nginx架构及核心流程及模块介绍" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NGINX/Nginx知识梳理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/NGINX/Nginx%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/NGINX/Nginx%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/">Nginx知识梳理</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>Nginx进程管理信信号</strong></p>
<p><img src="../images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dmazI5NzUwMTk2NzE=,size_16,color_FFFFFF,t_70.png" alt="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dmazI5NzUwMTk2NzE=,size_16,color_FFFFFF,t_70"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/NGINX/Nginx%E7%9F%A5%E8%AF%86%E6%A2%B3%E7%90%86/" data-id="ckmujocm4000h2vrsbup16s4f" data-title="Nginx知识梳理" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NGINX/nginx  resolver" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/NGINX/nginx%20%20resolver/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/NGINX/nginx%20%20resolver/">nginx  resolver</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>背景</strong>：nginx 配置proxy_pass后，访问接口出现no resolver defined to resolve错误，或者接口直接502，404，需要配置 nginx resolver</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	server_name wfk.mohuani.com</span><br><span class="line">	</span><br><span class="line">	location &#x2F; &#123;</span><br><span class="line">	resolver 114.114.114.114;</span><br><span class="line">	proxy_pass https:&#x2F;&#x2F;wfk.mohuani.com&#x2F;abc&#x2F;$1&#x2F;$2  ---404</span><br><span class="line">	proxy_pass https:&#x2F;&#x2F;www.baidu.com&#x2F;abc&#x2F;$1&#x2F;$2  ---502</span><br><span class="line">	proxy_pass https:&#x2F;&#x2F;113.105.77.194&#x2F;abc&#x2F;$1&#x2F;$2  ---404</span><br><span class="line">	proxy_pass https:&#x2F;&#x2F;127.0.0.1&#x2F;abc&#x2F;$1&#x2F;$2   ---404</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="不配置-resolver的情况接口的状态"><a href="#不配置-resolver的情况接口的状态" class="headerlink" title="不配置 resolver的情况接口的状态"></a>不配置 resolver的情况接口的状态</h5><ul>
<li>proxy_pass 代理的是域名（非自身server_name），且代理的地址中包含变量，接口502</li>
<li>proxy_pass 代理的是ip，且代理的地址中包含变量，接口404</li>
<li>proxy_pass 代理的域名如果和自身server_name相同接口会404，如果和自身的server_name不相同的话接口会502</li>
</ul>
<p> ps：个人猜测，当proxy_pass 设置为自身server_name 时，server_name会被转成127.0.0.1，导致接口报的是404，而不是502。</p>
<h5 id="具体什么情况下需要配置-resolver"><a href="#具体什么情况下需要配置-resolver" class="headerlink" title="具体什么情况下需要配置 resolver"></a>具体什么情况下需要配置 resolver</h5><ul>
<li>proxy_pass 代理的是<strong>域名</strong>或者<strong>ip</strong>,且代理的接口中包含 <strong>变量</strong></li>
</ul>
<h5 id="resolver设置哪些DNS"><a href="#resolver设置哪些DNS" class="headerlink" title="resolver设置哪些DNS"></a>resolver设置哪些DNS</h5><p>resolver 设置公共的DNS或者公司内部的DNS都可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">resolver 114.114.114.114;</span><br><span class="line">resolver 8.8.8.8;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/NGINX/nginx%20%20resolver/" data-id="ckmujocm5000i2vrsfdjtaj61" data-title="nginx  resolver" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-NGINX/nginx关键字" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/NGINX/nginx%E5%85%B3%E9%94%AE%E5%AD%97/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T11:36:38.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/NGINX/nginx%E5%85%B3%E9%94%AE%E5%AD%97/">nginx关键字</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>对关键字的解释会慢慢加上</p>
<p>master进程：<br>worker进程：<br>pass_proxy</p>
<hr>
<p>core Nginx.c：<br>daemon<br>master_process<br>timer_resolution<br>pid<br>lock_file<br>worker_processes<br>debug_points<br>user<br>worker_priority<br>worker_cpu_affinity<br>worker_rlimit_nofile<br>worker_rlimit_core<br>worker_rlimit_sigpending<br>working_directory<br>worker_threads<br>thread_stack_size</p>
<p>core Ngx_conf_file.c:<br>include</p>
<p>event Ngx_devpoll_modules.c:<br>devpoll_changes<br>devpoll_events</p>
<p>event Ngx_epoll_modules.c:<br>epoll_events</p>
<p>event Ngx_event.c:<br>events<br>worker_connections<br>connections<br>use<br>multi_accept<br>accept_mutex<br>accept_mutex_delay<br>debug_connection</p>
<p>core Ngx_eventport_modules.c:<br>eventport_events</p>
<p>core Ngx_event_openssl.c:<br>ssl_engine</p>
<p>http Ngx_http.c:<br>http</p>
<p>http modules Ngx_http_access_modules.c:<br>allow<br>deny</p>
<p>http modules Ngx_http_addition_filter_modules.c:<br>add_before_body<br>add_after_body</p>
<p>http modules Ngx_http_auth_basic_modules.c:<br>auth_basic<br>auth_basic_user_file</p>
<p>http modules Ngx_http_autoindex_module.c:<br>autoindex<br>autoindex_localtime<br>autoindex_exact_size</p>
<p>http modules Ngx_http_browser_module.c:<br>modern_browser<br>ancient_browser<br>modern_browser_value<br>ancient_browser_value</p>
<p>http modules Ngx_http_charset_filter_module.c:<br>charset<br>source_charset<br>override_charset<br>charset_map</p>
<p>http Ngx_http_copy_filter_module.c:<br>output_buffers</p>
<p>http Ngx_http_core_module.c:<br>variables_hash_max_size<br>variables_hash_bucket_size<br>server_names_hash_max_size<br>server_names_hash_bucket_size<br>server<br>connection_pool_size<br>request_pool_size<br>client_header_timeout<br>client_header_buffer_size<br>large_client_header_buffers<br>optimize_server_names<br>optimize_host_names<br>ignore_invalid_headers<br>location<br>listen<br>server_name<br>types_hash_max_size<br>types_hash_bucket_size<br>types<br>default_type<br>root<br>alias<br>limit_except<br>client_max_body_size<br>client_body_buffer_size<br>client_body_timeout<br>client_body_temp_path<br>client_body_in_file_only<br>sendfile<br>tcp_nopush<br>tcp_nodelay<br>send_timeout<br>send_lowat<br>postpone_output<br>limit_rate<br>keepalive_timeout<br>satisfy_any<br>internal<br>lingering_time<br>lingering_timeout<br>reset_timedout_connection<br>port_in_redirect<br>msie_padding<br>msie_refresh<br>log_not_found<br>recursive_error_pages<br>error_page<br>post_action<br>error_log<br>open_file_cache</p>
<p>http modules ngx_http_dav_module.c:<br>dav_methods<br>create_full_put_path<br>dav_access</p>
<p>http modules ngx_http_empty_gif_module.c:<br>empty_gif</p>
<p>http modules ngx_http_fastcgi_module.c:<br>fastcgi_pass<br>fastcgi_index<br>fastcgi_ignore_client_abort<br>fastcgi_connect_timeout<br>fastcgi_send_timeout<br>fastcgi_send_lowat<br>fastcgi_buffer_size<br>fastcgi_header_buffer_size<br>fastcgi_pass_request_headers<br>fastcgi_pass_request_body<br>fastcgi_intercept_errors<br>fastcgi_redirect_errors<br>fastcgi_read_timeout<br>fastcgi_buffers<br>fastcgi_busy_buffers_size<br>fastcgi_temp_path<br>fastcgi_max_temp_file_size<br>fastcgi_temp_file_write_size<br>fastcgi_next_upstream<br>fastcgi_upstream_max_fails<br>fastcgi_upstream_fail_timeout<br>fastcgi_param<br>fastcgi_pass_header<br>fastcgi_hide_header</p>
<p>http modules ngx_http_flv_modules.c:<br>flv</p>
<p>http modules ngx_http_geo_modules.c:<br>geo</p>
<p>http modules ngx_http_gzip_filter_modules.c:<br>gzip<br>gzip_buffers<br>gzip_types<br>gzip_comp_level<br>gzip_window<br>gzip_hash<br>gzip_no_buffer<br>gzip_http_version<br>gzip_proxied<br>gzip_min_length</p>
<p>http modules ngx_http_headers_filter_modules.c:<br>expires<br>add_header</p>
<p>http modules ngx_http_index_modules.c:<br>index<br>index_cache</p>
<p>http modules ngx_http_log_modules.c:<br>log_format<br>access_log</p>
<p>http modules ngx_http_map_modules.c:<br>map<br>map_hash_max_size<br>map_hash_bucket_size</p>
<p>http modules ngx_http_memcached_modules.c:<br>memcached_pass<br>memcached_connect_timeout<br>memcached_send_timeout<br>memcached_buffer_size<br>memcached_read_timeout<br>memcached_next_upstream<br>memcached_upstream_max_fails<br>memcached_upstream_fail_timeout</p>
<p>mysql ngx_http_mysql_test.c<br>mysql_test</p>
<p>http modules ngx_http_perl_modules.c:<br>perl_modules<br>perl_require<br>perl<br>perl_set</p>
<p>http modules ngx_http_proxy_modules.c:<br>proxy_pass<br>proxy_redirect<br>proxy_buffering<br>proxy_ignore_client_abort<br>proxy_connect_timeout<br>proxy_send_timeout<br>proxy_send_lowat<br>proxy_intercept_errors<br>proxy_redirect_errors<br>proxy_set_header<br>proxy_set_body<br>proxy_method<br>proxy_pass_request_headers<br>proxy_pass_request_body<br>proxy_buffer_size<br>proxy_header_buffer_size<br>proxy_read_timeout<br>proxy_buffers<br>proxy_busy_buffers_size<br>proxy_temp_path<br>proxy_max_temp_file_size<br>proxy_temp_file_write_size<br>proxy_next_upstream<br>proxy_upstream_max_fails<br>proxy_upstream_fail_timeout<br>proxy_pass_header<br>proxy_hide_header</p>
<p>http modules ngx_http_realip_module.c:<br>set_real_ip_from<br>real_ip_header</p>
<p>http modules ngx_http_referer_module.c:<br>valid_referers</p>
<p>http modules ngx_http_rewrite_module.c:<br>rewrite<br>return<br>break<br>if<br>set<br>rewrite_log<br>uninitialized_variable_warn</p>
<p>http modules ngx_http_ssi_filter_module.c:<br>ssi<br>ssi_silent_errors<br>ssi_ignore_recycled_buffers<br>ssi_min_file_chunk<br>ssi_value_length<br>ssi_types</p>
<p>http modules Ngx_http_ssl_module.c:<br>ssl<br>ssl_certificate<br>ssl_certificate_key<br>ssl_protocols<br>ssl_ciphers<br>ssl_verify_client<br>ssl_verify_depth<br>ssl_client_certificate<br>ssl_prefer_server_ciphers<br>ssl_session_timeout</p>
<p>http modules Ngx_http_static_module.c:<br>redirect_cache</p>
<p>http modules Ngx_http_status_module.c:<br>status</p>
<p>http modules Ngx_http_stub_status_module.c:<br>stub_status</p>
<p>http Ngx_http_upstream.c:<br>upstream<br>server</p>
<p>http modules Ngx_http_upstream_ip_hash_module.c：<br>ip_hash</p>
<p>http modules Ngx_http_userid_filter_module.c：<br>userid<br>userid_service<br>userid_name<br>userid_domain<br>userid_path<br>userid_expires<br>userid_p3p<br>userid_mark</p>
<p>imap Ngx_imap.c：<br>imap</p>
<p>imap Ngx_imap_auth_http_module.c:<br>auth_http<br>auth_http_timeout<br>auth_http_header</p>
<p>imap Ngx_imap_core_module.c:<br>server<br>listen<br>protocol<br>imap_client_buffer<br>so_keepalive<br>timeout<br>pop3_capabilities<br>imap_capabilities<br>server_name<br>auth</p>
<p>imap Ngx_imap_proxy_module.c:<br>proxy<br>proxy_buffer<br>proxy_timeout<br>proxy_pass_error_message</p>
<p>imap Ngx_imap_ssl_module.c:<br>ssl<br>starttls<br>ssl_certificate<br>ssl_certificate_key<br>ssl_protocols<br>ssl_ciphers<br>ssl_prefer_server_ciphers<br>ssl_session_timeout</p>
<p>event modules Ngx_iocp_module.c:<br>iocp_threads<br>post_acceptex<br>acceptex_read</p>
<p>event modules Ngx_kqueue_module.c:<br>kqueue_changes<br>kqueue_events</p>
<p>core Ngx_log.c:<br>error_log</p>
<p>event modules Ngx_rtsig_module.c:<br>rtsig_signo<br>rtsig_overflow_events<br>rtsig_overflow_test<br>rtsig_overflow_threshold</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mohuani.github.io/2021/03/24/NGINX/nginx%E5%85%B3%E9%94%AE%E5%AD%97/" data-id="ckmujocm5000j2vrsaf79hus3" data-title="nginx关键字" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/03/30/%E8%BF%90%E7%BB%B4/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/">mac环境变量</a>
          </li>
        
          <li>
            <a href="/2021/03/29/Git/Git%20Commit%20Template/">Git Commit Template</a>
          </li>
        
          <li>
            <a href="/2021/03/29/Git/git%20submoudle/">git submoudle</a>
          </li>
        
          <li>
            <a href="/2021/03/24/Golang/5G%E6%97%B6%E4%BB%A3Vlog%E5%8E%9F%E5%9E%8B%E7%B3%BB%E7%BB%9F%E5%BC%80%E5%8F%91/">5G时代Vlog原型系统开发</a>
          </li>
        
          <li>
            <a href="/2021/03/24/Git/gitignore%E6%96%87%E4%BB%B6%E4%B8%8D%E7%94%9F%E6%95%88/">gitignore文件不生效</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 mohuani<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>